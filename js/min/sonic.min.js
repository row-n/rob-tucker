!function(){function t(t){this.data=t.path||t.data,this.imageData=[],this.multiplier=t.multiplier||1,this.padding=t.padding||0,this.fps=t.fps||25,this.stepsPerFrame=~~t.stepsPerFrame||1,this.trailLength=t.trailLength||1,this.pointDistance=t.pointDistance||.05,this.domClass=t.domClass||"sonic",this.fillColor=t.fillColor||"#FFF",this.strokeColor=t.strokeColor||"#FFF",this.stepMethod="string"==typeof t.step?a[t.step]:t.step||a.square,this._setup=t.setup||i,this._teardown=t.teardown||i,this._preStep=t.preStep||i,this.width=t.width,this.height=t.height,this.fullWidth=this.width+2*this.padding,this.fullHeight=this.height+2*this.padding,this.domClass=t.domClass||"sonic",this.setup()}var i=function(){},s=t.argTypes={DIM:1,DEGREE:2,RADIUS:3,OTHER:0},h=t.argSignatures={arc:[1,1,3,2,2,0],bezier:[1,1,1,1,1,1,1,1],line:[1,1,1,1]},e=t.pathMethods={bezier:function(t,i,s,h,e,a,n,r,l){t=1-t;var o=1-t,p=t*t,d=o*o,f=p*t,u=3*p*o,c=3*t*d,g=d*o;return[f*i+u*a+c*r+g*h,f*s+u*n+c*l+g*e]},arc:function(t,i,s,h,e,a){var n=(a-e)*t+e,r=[Math.cos(n)*h+i,Math.sin(n)*h+s];return r.angle=n,r.t=t,r},line:function(t,i,s,h,e){return[(h-i)*t+i,(e-s)*t+s]}},a=t.stepMethods={square:function(t){this._.fillRect(t.x-3,t.y-3,6,6)},fader:function(t){this._.beginPath(),this._last&&this._.moveTo(this._last.x,this._last.y),this._.lineTo(t.x,t.y),this._.closePath(),this._.stroke(),this._last=t}};t.prototype={setup:function(){var t,i,a,n,r=this.data;this.canvas=document.createElement("canvas"),this._=this.canvas.getContext("2d"),this.canvas.className=this.domClass,this.canvas.height=this.fullHeight,this.canvas.width=this.fullWidth,this.points=[];for(var l=-1,o=r.length;++l<o;){if(t=r[l].slice(1),a=r[l][0],a in h)for(var p=-1,d=t.length;++p<d;){switch(i=h[a][p],n=t[p],i){case s.RADIUS:n*=this.multiplier;break;case s.DIM:n*=this.multiplier,n+=this.padding;break;case s.DEGREE:n*=Math.PI/180}t[p]=n}t.unshift(0);for(var f,u=this.pointDistance,c=u;1>=c;c+=u)c=Math.round(1*c/u)/(1/u),t[0]=c,f=e[a].apply(null,t),this.points.push({x:f[0],y:f[1],progress:c})}this.frame=0},prep:function(t){if(!(t in this.imageData)){this._.clearRect(0,0,this.fullWidth,this.fullHeight);{var i,s,h,e=this.points,a=e.length;this.pointDistance}this._setup();for(var n=-1,r=a*this.trailLength;++n<r&&!this.stopped;)s=t+n,i=e[s]||e[s-a],i&&(this.alpha=Math.round(1e3*(n/(r-1)))/1e3,this._.globalAlpha=this.alpha,this._.fillStyle=this.fillColor,this._.strokeStyle=this.strokeColor,h=t/(this.points.length-1),indexD=n/(r-1),this._preStep(i,indexD,h),this.stepMethod(i,indexD,h));return this._teardown(),this.imageData[t]=this._.getImageData(0,0,this.fullWidth,this.fullWidth),!0}},draw:function(){this.prep(this.frame)||(this._.clearRect(0,0,this.fullWidth,this.fullWidth),this._.putImageData(this.imageData[this.frame],0,0)),this.iterateFrame()},iterateFrame:function(){this.frame+=this.stepsPerFrame,this.frame>=this.points.length&&(this.frame=0)},play:function(){this.stopped=!1;var t=this;this.timer=setInterval(function(){t.draw()},1e3/this.fps)},stop:function(){this.stopped=!0,this.timer&&clearInterval(this.timer)}},window.Sonic=t}();